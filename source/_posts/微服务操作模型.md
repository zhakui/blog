---
title: 微服务操作模型
date: 2017-06-11 17:28:43
categories:
  Microservices
tags: 
  - Microservices
---

这里不仅仅是再次重复介绍一次微服务，有关微服务的介绍可以参考[Fowler - Microservices](http://martinfowler.com/articles/microservices.htmlFowler-Microservices).相反，这篇文章是基于我们已经开始使用微服务来分解我们的应用程序以期提高我们的应用的可部署下和可伸缩性。
当在系统环境中部署的微服务数量增加，单体式应用程序部署减少时，将遇到新的挑战，本文将重点关注这些新的挑战，并为使用大量微服务部署的系统环境定义操作模型。

本文将分为下面几个部分：
1. 前提条件
2. 扩大
3. 问题
4. 必须的组件
5. 参考模型

# 1 前提条件
首先，在系统环境中使用大量微服务需要什么？
更具Fowler的博客中介绍，这是我们想要实现的目标：
![](./microservices-1.png)
Source: （http://martinfowler.com/articles/microservices.html)
但是，我们在我们的系统环境中大量使用微服务取代我们的单体式应用程序之前，需要满足一些先决条件（部分可能不是许）：
- 目标架构
- 一个持续的交付工具链
- 一个适当的组织

## 1.1 目标架构
首先，我们需要思考，我们如何划分所有微服务。例如我们可以在某些层中垂直划分我们的微服务：
- '核心服务'：处理业务数据的持久性并应用业务规则和其他逻辑
- '组合服务'：组合服务可以协调许多核心服务以执行常见任务或聚合来自多个核心服务的信息。
- 'API服务'：暴露允许外部使用的功能，例如：在系统环境中使用的第三方提供的基础功能。

...横向，我们可以通过定义不同的域，然后根据不同的域进行分区。可形成类似下面的目标架构。
![](./microservices-architecture.png)
Note：这只是一个示例目标架构，您的架构可以完全不同。 这里的关键是，在开始扩展部署微服务之前，需要建立目标体系结构。 否则，您可能最终会进入一个看起来像一大碗意大利面条的系统环境（混乱不堪），其特性甚至比现有的单片应用程序更差。

## 1.2 持续的交付
我们还假设我们拥有某种连续交付工具链，以便我们能够以有效的可重复和质量驱动的方式推出我们的微服务，例如：
![](./microservices-1-2.png)
Source:（http://www.infoq.com/minibooks/emag-devops-toolchain)

## 1.3 组织
最后，我们假设我们采用我们的组织来避免康威定律的问题。 康威的法律规定：
> Any organization that designs a system (defined broadly) will produce a design whose structure is a copy of the organization’s communication structure. 

![](./microservices-1-1.png)
Source: (http://martinfowler.com/articles/microservices.html)

# 2 扩大
现在,提出本文关注的内容：
> 当我们开始拆分一些单片应用程序并用大量微服务替换它们时，系统环境会发生什么？
1. '大量的部署单元',许多小型微服务而不是几个大型的单片应用程序，这将导致需要管理和跟踪的部署单元数量显著增加。
2. '微服务同时是服务提供者和服务消费者'，这将导致系统环境中大多数微服务相互连接，服务调用关系更加复杂。
3. '一些微服务将暴露外部API'，这些微服务将负责屏蔽其他微服务免受外部访问
4. '系统环境将更加动态'，新的微服务被部署，旧的微服务被替换或移除，已有的微服务的新实例被启动以满足不断增加的负载。 这意味着服务将以前所未有的频率更替（新增，移除、替换、追加实例）。
5. 'MTBF（平均故障间隔时间）将减少',例如:故障将在系统环境中更频繁地发生,软件组件会不时出现故障。与仅具有少量大型单片应用程序的系统环境相比，大量小型部署单元的系统环境，系统环境中的某些部件（即使很小）发生故障的可能性将会增加。

# 3 问题
这将在某些情况下会出现导致一些重要的与运行时相关的新问题：
1. '如何配置我的微服务并且它是否正确？',
2. '需要部署那些微服务，部署到哪里？'
3. '如果更新路由信息？‘
4. ''
